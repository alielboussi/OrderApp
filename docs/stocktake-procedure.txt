Stocktake Procedure (Outlet Warehouses)

Goal
- Capture opening counts, allow movements, then capture closing counts and variance.
- Ensure POS sync is paused during final closing counts to prevent live sales from shifting balances.

Pre-checks (one-time)
- Outlet has a default sales warehouse.
- Deduct warehouses are set in Outlet Setup.
- Recipes are set for finished + ingredient items.
- POS item map is complete.

Step-by-step
1) Pause POS sync
   - Use Warehouse Backoffice → POS Sync Control → set to Paused.
   - If you cannot pause, stop taking POS sales during counting.

2) Open period
   - Open the Stocktake app.
   - Select Outlet → Warehouse.
   - Press Start stocktake (creates an open period).

3) Record opening counts
   - Enter opening counts for all ingredients and variants in that warehouse.
   - Save counts; confirm items show in the period.

4) Resume normal operations
   - Resume POS sync (set to Active).
   - Continue sales, transfers, purchases, damages during the period.

5) Prepare to close
   - At closing time, pause POS sync again.
   - Stop new sales and wait for any queued POS sync to finish.

6) Record closing counts
   - In the Stocktake app, enter closing counts for all items.

7) Close the period
   - Press Close period.
   - A new period auto-opens with closing counts carried forward as opening.

8) Review variance
   - Go to Stocktake → View variance for the closed period.
   - Review over/short by item and investigate outliers.

9) Resume POS sync
   - Set POS Sync Control back to Active.

Notes
- Do not rely on stock ledger for visibility; stocktake lists are driven by catalog + outlet routes.
- Raws are excluded from stocktake counts; ingredients/variants are included.
- If you must keep sales open during counting, expect variances to rise.
